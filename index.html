<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Studentlist_2</title>

    <style>
      :root {
        --gryffindor-bg-color: #ce3a0a;
        --gryffindor-txt-color: #fdb02e;

        --hufflepuff-bg-color: #ffc02a;
        --hufflepuff-txt-color: #0b0000;

        --ravenclaw-bg-color: #395f9d;
        --ravenclaw-txt-color: #e9ba36;

        --slytherin-bg-color: #588c39;
        --slytherin-txt-color: #c0b1c6;

        --stdFont: Avenir, Verdana, sans-serif;
      }

      * {
        margin: 0;
        padding: 0;
      }

      body {
          background-color: aliceblue;
      }

      .gryffindor {
          background-color: var(--gryffindor-bg-color);
          color: var(--gryffindor-txt-color);
      }

      .hufflepuff {
        background-color: var(--hufflepuff-bg-color);
        color: var(--hufflepuff-txt-color);
      }

      .ravenclaw {
        background-color: var(--ravenclaw-bg-color);
        color: var(--ravenclaw-txt-color);
      }

      .slytherin {
          background-color: var(--slytherin-bg-color);
          color: var(--slytherin-txt-color);  
      }

      .pWrap {
            width: 300px;
            display: flex;
            justify-content: space-between;
            padding: 5px;
      }

      button {
          padding: 3px;
          border-radius: 5%;
          font-family: var(--stdFont);
      }

      #modal {
        width: 100%;
        height: 100%;
        position: fixed;
        opacity: 0;
        pointer-events: none;
        transition: 1s;
        top: 0;
        left: 0;
        z-index: 1;
        color: rgb(0, 0, 0);
      }

      #modalContent {
        margin: 15% auto;
        width: 50%;
        text-align: center;
        padding: 30px;
      }
      
      #modal h1 {
        font-size: 2em;
      }



      #close {
        width: 10%;
        height: 5%;
        cursor: pointer;
        background: var(--hvid);
        border: 0;
        transition: .4s;
    }

      #modal.show_modal {
        opacity: 1;
        pointer-events: all;
        transition: 0.5s;
      }



    </style>
</head>
<body>
    <section id="modal">


        

        <div id="modalContent">
            <button id="close">&#10006;

            </button>
          <h1 id="modalHeader">
            <span data-firstname></span>
            <span data-lastname></span>
          </h1>
          <h2 id="modalHouse"></h2>
          <img src="" alt="" id="modalImg">
        
        </div>

    </section>

  </section>
    <main>
        <div class="buttonContainer">
            <button class="sortButton firstNameButton">Sort by Firstname</button>
            <button class="sortButton lastNameButton">Sort by Lastname</button>
            <button class="sortButton">Sort by House</button>
            <button data-category="Gryffindor" class="filterButton gryffindor">Gryffindor students</button>
            <button data-category="Hufflepuff" class="filterButton hufflepuff">Hufflepuff students</button>
            <button data-category="Ravenclaw" class="filterButton ravenclaw">Ravenclaw students</button>
            <button data-category="Slytherin" class="filterButton slytherin">Slytherin students</button>
            <button data-category="All" class="filterButton">All students</button>
          </div>
        <section class="data-container">
          

        </section>
    </main>

    <template class="data-template">
        <div class="pWrap">
          <p class="name"> 
            <span data-firstname></span>
            <span data-lastname></span> 
             
          </p>
          <p data-house></p>
        </div>
    </template>
    <script>
        let thisJson;
        let dest = document.querySelector(".data-container");
        let houseFilter = "All";
        let modal = document.querySelector("#modal");
        

        document.addEventListener("DOMContentLoaded", init);

        function init() {

          getJson();

        } 

        async function getJson() {

          let myJson = await fetch("http://petlatkea.dk/2019/students1991.json");
          thisJson = await myJson.json();
          showJson();
        }

        function showJson() {

          let myTemplate = document.querySelector(".data-template");

          let studentsFullName = thisJson;

          thisJson.forEach(post => {
            let firstSpace = post.fullname.indexOf(" ");
            let lastSpace = post.fullname.lastIndexOf(" ");
            
            if (post.house == houseFilter || houseFilter == "All") {

              let klon = myTemplate.cloneNode(true).content;
              klon.querySelector("[data-firstname]").textContent = post.fullname.substring(0, firstSpace);
              klon.querySelector("[data-lastname]").textContent = post.fullname.substring(lastSpace, );
              klon.querySelector("[data-house]").textContent = post.house;
              

              klon.querySelector(".name").addEventListener("click", () => {
                        showModal(post);
              });

              dest.appendChild(klon);
            }
          });
          
        }
        
        function filtering() {
            dest.textContent = "";
            houseFilter = this.getAttribute("data-category");
            showJson();
        }
        
        document.querySelectorAll(".filterButton").forEach(knap => {
            knap.addEventListener("click", filtering)
        });

        function showModal(post) {
            let firstSpace = post.fullname.indexOf(" ");
            let lastSpace = post.fullname.lastIndexOf(" ");

            modal.classList.add("show_modal");
            
            modal.querySelector("[data-firstname]").textContent = post.fullname.substring(0, firstSpace);
            modal.querySelector("[data-lastname]").textContent = post.fullname.substring(lastSpace, );
            modal.querySelector("#modalHouse").textContent = post.house;
            modal.querySelector("#modalImg").src = "images/" + (post.fullname.substring(lastSpace + 1, ) + "_" + post.fullname.substring(0, 1)).toLowerCase() + ".png";

            console.log(post.house);

            if (post.house == "Gryffindor") {
                modal.querySelector("#modalContent").classList.add("gryffindor");
            }

            if (post.house == "Hufflepuff") {
                modal.querySelector("#modalContent").classList.add("hufflepuff");
            }
            if (post.house == "Ravenclaw") {
                modal.querySelector("#modalContent").classList.add("ravenclaw");
            }
            if (post.house == "Slytherin") {
                modal.querySelector("#modalContent").classList.add("slytherin");
            }

            document.querySelector("#close").addEventListener("click", hideModal);
        }

        function hideModal() {
            modal.classList.remove("show_modal");
            setTimeout(function() {
              modal.querySelector("#modalContent").classList.remove("hufflepuff", "gryffindor", "ravenclaw", "slytherin");
           
            }, 500);
        }

        

    </script>
</body>
</html>
