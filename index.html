<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Studentlist_2</title>

    <style>
      :root {
        --gryffindor-bg-color: #ce3a0a;
        --gryffindor-txt-color: #fdb02e;

        --hufflepuff-bg-color: #ffc02a;
        --hufflepuff-txt-color: #0b0000;

        --ravenclaw-bg-color: #395f9d;
        --ravenclaw-txt-color: #e9ba36;

        --slytherin-bg-color: #588c39;
        --slytherin-txt-color: #c0b1c6;

        --stdFont: Avenir, Verdana, sans-serif;
      }

      * {
        margin: 0;
        padding: 0;
      }

      body {
          background-color: aliceblue;
      }

      .gryffindor {
          background-color: var(--gryffindor-bg-color);
          color: var(--gryffindor-txt-color);
      }

      .hufflepuff {
        background-color: var(--hufflepuff-bg-color);
        color: var(--hufflepuff-txt-color);
      }

      .ravenclaw {
        background-color: var(--ravenclaw-bg-color);
        color: var(--ravenclaw-txt-color);
      }

      .slytherin {
          background-color: var(--slytherin-bg-color);
          color: var(--slytherin-txt-color);  
      }

      .pWrap {
            width: 300px;
            display: flex;
            justify-content: space-between;
            padding: 5px;
      }

      button {
          padding: 3px;
          border-radius: 5%;
          font-family: var(--stdFont);
      }

      #modal {
        width: 100%;
        height: 100%;
        position: fixed;
        opacity: 0;
        pointer-events: none;
        transition: 1s;
        top: 0;
        left: 0;
        z-index: 1;
        color: rgb(0, 0, 0);
      }

      #modalContent {
        margin: 15% auto;
        width: 50%;
        text-align: center;
        padding: 30px;
      }
      
      #modal h1 {
        font-size: 2em;
      }



      #close {
        width: 10%;
        height: 5%;
        cursor: pointer;
        background: var(--hvid);
        border: 0;
        transition: .4s;
    }

      #modal.show_modal {
        opacity: 1;
        pointer-events: all;
        transition: 0.5s;
      }



    </style>
</head>
<body>
    <section id="modal">


        

        <div id="modalContent">
            <button id="close">&#10006;

            </button>
          <h1 id="modalHeader">
            <span data-firstname></span>
            <span data-lastname></span>
          </h1>
          <h2 id="modalHouse"></h2>
          <img src="" alt="" id="modalImg">
        
        </div>

    </section>

  </section>
    <main>
        <div class="buttonContainer">
            <button id="firstnameButton">Sort by Firstname</button>
            <button id="lastnameButton">Sort by Lastname</button>
            <button id="houseButton">Sort by House</button>
            <button id="gryffindor" class="gryffindor">Gryffindor students</button>
            <button id="hufflepuff" class="hufflepuff">Hufflepuff students</button>
            <button id="ravenclaw" class="ravenclaw">Ravenclaw students</button>
            <button id="slytherin" class="slytherin">Slytherin students</button>
            <button id="all">All students</button>
          </div>
        <section class="data-container">
          

        </section>
    </main>

    <template class="data-template">
        <div class="pWrap">
          <p class="name"> 
            <span data-firstname></span>
            <span data-lastname></span> 
             
          </p>
          <p data-house></p>

        </div>
        <button data-studentbutton></button>
    </template>
    <script>

    "use strict";

        let thisJson;
        let dest = document.querySelector(".data-container");
        let modal = document.querySelector("#modal");
        let houseFilter = "";

        document.addEventListener("DOMContentLoaded", init);

        function init() {

          document.querySelector("#gryffindor").addEventListener("click", sortGryffindor);
          document.querySelector("#hufflepuff").addEventListener("click", sortHufflepuff);
          document.querySelector("#ravenclaw").addEventListener("click", sortRavenclaw);
          document.querySelector("#slytherin").addEventListener("click", sortSlytherin);
          document.querySelector("#all").addEventListener("click", sortAll);


          getJson();

        } 

        async function getJson() {

          let myJson = await fetch("students1991.json");
          thisJson = await myJson.json();
          createStudents(thisJson);
        }

        const Student = {
          firstname: "student firstname",
          lastname: "student lastname",
          house: "student house",
          studentbutton: "student button",
          
          setJsonData ( studentData ) {
            let firstSpace = studentData.fullname.indexOf(" ");
            let lastSpace = studentData.fullname.lastIndexOf(" ");

            this.firstname = studentData.fullname.substring(0, firstSpace);
            this.lastname = studentData.fullname.substring(lastSpace + 1, );
            this.house = studentData.house;
            this.studentbutton = "Expel " + studentData.fullname.substring(0, firstSpace) + " " + studentData.fullname.substring(lastSpace + 1, );
          },
        
        }

        const arrayOfStudents = [];

        function createStudents() {

          thisJson.forEach(studentData => {
              let studentPrototype = Object.create(Student);

              studentPrototype.setJsonData( studentData );
              
              arrayOfStudents.push(studentPrototype);
              
          });
          filterList(houseFilter);

        }

        function sortGryffindor() {
          houseFilter = "gryffindor";
          filterList(houseFilter);
        }
        
        function sortHufflepuff() {
          houseFilter = "hufflepuff";
          filterList(houseFilter);
        }

        function sortRavenclaw() {
          houseFilter = "ravenclaw";
          filterList(houseFilter);
        }

        function sortSlytherin() {
          houseFilter = "slytherin";
          filterList(houseFilter);
        }

        function sortAll() {
          houseFilter = "";
          filterList(houseFilter);
        }

        function filterByHouse(house) {
          function onlyHouse( element ) {
              if (element.house.toLowerCase() === house.toLowerCase() ) {
                  return true;
              }
              else {
                  return false;
              }
          }
        return arrayOfStudents.filter(onlyHouse);
        }

        function filterList(houseFilter) {
         
          let filteredList = arrayOfStudents;

          if (houseFilter === "") {
            
          }
          else if (houseFilter === "gryffindor") {
            filteredList = filterByHouse("gryffindor");
          }
          else if (houseFilter === "hufflepuff") {
            filteredList = filterByHouse("hufflepuff");
          }
          else if (houseFilter === "ravenclaw") {
            filteredList = filterByHouse("ravenclaw");
          }
          else if (houseFilter === "slytherin") {
            filteredList = filterByHouse("slytherin");
          }
          
          showJson(filteredList);
          document.querySelector("#firstnameButton").addEventListener("click", function() {
            callSortByFirstname(filteredList);
          });
          document.querySelector("#lastnameButton").addEventListener("click", function() {
            callSortByLastname(filteredList);
          });
          document.querySelector("#houseButton").addEventListener("click", function() {
            callSortByHouse(filteredList);
          });
          return filteredList;

        }



        function callSortByFirstname(filteredList) {
          
          filteredList.sort(sortByFirstname);
          showJson(filteredList);
          console.log(filteredList);
          return filteredList;
          
          
        }

        function callSortByLastname(filteredList) {
          
          filteredList.sort(sortByLastname);
          showJson(filteredList);
          return filteredList;
          
          
        }

        function callSortByHouse(filteredList) {
          
          filteredList.sort(sortByHouse);
          showJson(filteredList);
          return filteredList;
          
          
        }

        function sortByFirstname(a, b) {
          if( a.firstname < b.firstname) {
            return -1;

          }
          else {
            return 1;
          }
          
        }

        function sortByLastname(a, b) {
          if( a.lastname < b.lastname) {
            return -1;

          }
          else {
            return 1;
          }
          
        }
        
        function sortByHouse(a, b) {
          if( a.house < b.house) {
            return -1;

          }
          else {
            return 1;
          }
          
        }
        

       

        function showJson(filteredList, sortedList) {

          let myTemplate = document.querySelector(".data-template");
          dest.textContent = "";

          filteredList.forEach(post => {
            

              let klon = myTemplate.cloneNode(true).content;
              klon.querySelector("[data-firstname]").textContent = post.firstname;
              klon.querySelector("[data-lastname]").textContent = post.lastname;
              klon.querySelector("[data-house]").textContent = post.house;
              klon.querySelector("[data-studentbutton]").textContent = post.studentbutton;
              

              klon.querySelector(".name").addEventListener("click", () => {
                showModal(post);
              });
              klon.querySelector("[data-studentbutton]").addEventListener("click", () => {
                expelStudent(post);
              });

              dest.appendChild(klon);
            }
            
          );
        }

       
        


        function showModal(post) {

            modal.classList.add("show_modal");
            
            modal.querySelector("[data-firstname]").textContent = post.firstname;
            modal.querySelector("[data-lastname]").textContent = post.lastname;
            modal.querySelector("#modalHouse").textContent = post.house;
            modal.querySelector("#modalImg").src = "images/" + (post.lastname + "_" + post.firstname.substring(0, 1)).toLowerCase() + ".png";

            if (post.house == "Gryffindor") {
                modal.querySelector("#modalContent").classList.add("gryffindor");
            }

            if (post.house == "Hufflepuff") {
                modal.querySelector("#modalContent").classList.add("hufflepuff");
            }
            if (post.house == "Ravenclaw") {
                modal.querySelector("#modalContent").classList.add("ravenclaw");
            }
            if (post.house == "Slytherin") {
                modal.querySelector("#modalContent").classList.add("slytherin");
            }

            document.querySelector("#close").addEventListener("click", hideModal);
        }

        function hideModal() {
            modal.classList.remove("show_modal");
            setTimeout(function() {
              modal.querySelector("#modalContent").classList.remove("hufflepuff", "gryffindor", "ravenclaw", "slytherin");
           
            }, 500);
        }

        function expelStudent() {
          console.log("1");
        }

        

    </script>
</body>
</html>
